
# 2018-07-10 13:46:47.055081
+\d

# 2018-07-10 13:47:04.069027
+select count(1) from experiment_logs;

# 2018-07-10 13:47:13.831350
+select * from experiment_logs limit 1;

# 2018-07-10 13:47:56.266825
+select * from experiment_logs where experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' limit 1;

# 2018-07-10 13:50:17.241460
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and b.completed_at is not null;

# 2018-07-10 13:50:59.806807
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and o.completed_at is not null;

# 2018-07-10 13:53:05.916479
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans ON subscription_plans.id = s.subscription_plan_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and sp.profile_type = 1;

# 2018-07-10 13:53:43.533747
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and sp.profile_type = 1;

# 2018-07-10 13:54:26.263486
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and sp.profile_type = 0;

# 2018-07-10 13:55:35.709408
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant = 'control'  and b.completed_at is not null;

# 2018-07-10 13:55:56.053525
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant = 'control' and o.completed_at is not null;

# 2018-07-10 13:56:25.856960
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans ON subscription_plans.id = s.subscription_plan_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant = 'control' and sp.profile_type = 1;

# 2018-07-10 13:56:45.156111
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant = 'control' and sp.profile_type = 1;

# 2018-07-10 13:57:06.143605
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant = 'control' and sp.profile_type = 0;

# 2018-07-10 13:57:32.968764
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant != 'control' and o.completed_at is not null;

# 2018-07-10 13:57:49.871560
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant != 'control'  and b.completed_at is not null;

# 2018-07-10 13:58:06.801439
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant != 'control' and sp.profile_type = 1;

# 2018-07-10 13:58:21.021465
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' and el.variant != 'control' and sp.profile_type = 0;

# 2018-07-10 13:58:42.493419
+select * from experiment_logs where experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' limit 1;

# 2018-07-10 13:58:48.396957
+select * from experiment_logs where experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' limit 10;

# 2018-07-10 13:59:14.845645
+select variant from experiment_logs where experiment = '1-CTA-vs-2-CTA-on-homepage-header-80-20' group by variant;

# 2018-07-10 14:02:25.921438
+\q

# 2018-07-17 11:23:06.044053
+select * from company_adm

# 2018-07-17 11:23:10.527265
+select * from company_admin_authentication_sessions;

# 2018-07-17 14:24:58.258198
+select * from company_admin_authentication_codes;

# 2018-07-20 11:27:49.830155
+\dt

# 2018-07-20 11:28:50.335412
+\d company_admin_employee_import_request_records

# 2018-07-20 12:16:59.955456
+\d company_admin_employee_import_requests

# 2018-07-20 14:16:40.580581
+select * from experiments limit 10;

# 2018-07-20 14:17:07.346893
+select * from experiment_logs limit 1;

# 2018-07-20 14:17:24.326376
+select group(experiment) from experiment_logs limit 10;

# 2018-07-20 14:17:35.086137
+select experiment from experiment_logs group by experiment limit 10;

# 2018-07-20 14:17:49.211255
+select experiment from experiment_logs group by experiment order by experiment_id desc limit 100;

# 2018-07-20 14:17:54.261067
+select experiment from experiment_logs group by experiment order by id desc limit 100;

# 2018-07-20 14:18:05.079748
+select experiment from experiment_logs group by experiment desc limit 100;

# 2018-07-20 14:18:09.954505
+select experiment from experiment_logs group by experiment limit 100;

# 2018-07-20 14:18:51.238886
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'control' and sp.profile_type = 0;

# 2018-07-20 14:19:39.760096
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'alternative' and sp.profile_type = 0;

# 2018-07-20 14:19:52.644854
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'control' and sp.profile_type = 1;

# 2018-07-20 14:20:02.557041
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'alternative' and sp.profile_type = 1;

# 2018-07-20 14:22:30.515497
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = '1-CTA-vs-2-CTA-on-homepage-header-50-50' and el.variant = 'control' and o.completed_at is not null;

# 2018-07-20 14:22:58.639927
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control' and o.completed_at is not null;

# 2018-07-20 14:23:38.881845
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id inner join owners o on ui.id = o.user_identity_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative' and o.completed_at is not null;

# 2018-07-20 14:25:45.163824
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control';

# 2018-07-20 14:26:22.998928
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative';

# 2018-07-20 14:27:08.970544
+select count(distinct user_id) from experiment_logs el where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control';

# 2018-07-20 14:27:24.018143
+select count(distinct user_id) from experiment_logs el where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative';

# 2018-07-20 14:41:25.734610
+\q

# 2018-07-20 16:56:29.846244
+\q

# 2018-07-23 16:47:43.213737
+\dt experiment_logs

# 2018-07-23 16:47:51.073425
+\d experiment_logs

# 2018-07-23 16:48:52.081003
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'control' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 0;

# 2018-07-23 16:51:49.039807
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant != 'control' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 1;

# 2018-07-23 16:53:36.255116
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative' and el.created_at < '2018-07-19T06:20:00';

# 2018-07-23 16:53:49.748113
+select count(1) from experiment_logs el inner join user_identities ui on el.user_id = ui.user_id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control' and el.created_at < '2018-07-19T06:20:00';

# 2018-07-23 16:57:37.365135
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 0;

# 2018-07-23 16:57:55.913405
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 0;

# 2018-07-23 16:58:14.448250
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'control' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 1;

# 2018-07-23 16:58:30.171410
+select count(1) from experiment_logs el inner join subscriptions s on el.user_id = s.user_id inner join subscription_plans sp ON s.subscription_plan_id = sp.id where el.experiment = 'search-versus-payment-on-signup-completion-50-50' and el.variant = 'alternative' and el.created_at < '2018-07-19T06:20:00' and sp.profile_type = 1;

# 2018-07-23 17:01:31.239075
+\q

# 2018-07-25 16:21:29.704574
+select * from verification_address_verifications order by random() limit 10;

# 2018-07-25 16:23:00.830243
+select * from count

# 2018-07-25 16:23:06.240940
+select * from countries limit 10

# 2018-07-26 14:02:23.463873
+select count(1) from users u left outer join verifications v on u.id = v.user_id left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and vav.id is null and vpv.id is null;

# 2018-07-26 14:03:05.295331
+select u.* from users u left outer join verifications v on u.id = v.user_id left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and vav.id is null and vpv.id is null;

# 2018-07-26 14:04:01.655765
+select u.* from users u left outer join verifications v on u.id = v.user_id left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null;

# 2018-07-26 14:04:55.128010
+select u.* from users u left outer join verifications v on u.id = v.user_id left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:08:41.988616
+select * from users u left outer join verifications v on u.id = v.user_id left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.id = 4012 and u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:08:57.510110
+select * from verifications where user_id = 4012;

# 2018-07-26 14:11:10.004530
+select * from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.id = 4012 and u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:11:36.337174
+select u.* from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:12:18.303742
+select * from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.id = 623398 and u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:12:29.062841
+select * from verifications where user_id = 623398;

# 2018-07-26 14:12:48.186663
+select * from verification_address_verifications where verification_id = 103893;

# 2018-07-26 14:13:01.769886
+select * from verification_phone_verifications where verification_id = 103893;

# 2018-07-26 14:14:03.956403
+select * from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.id = 623398 and u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:17:27.492543
+select u.* from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:18:13.082570
+select * from users u left outer join verifications v on u.id = v.user_id and v.state = 0 left outer join verification_address_verifications vav ON vav.verification_id = v.id left outer join verification_phone_verifications vpv ON vpv.verification_id = v.id where u.id = 504023 and u.verified = 't' and u.deleted_at is null and vav.id is null and vpv.id is null order by u.id;

# 2018-07-26 14:19:24.029621
+select * from verifications where user_id = 504023;

# 2018-07-26 14:20:53.010206
+select * from verification_address_verifications where verification_id = 149376;

# 2018-07-26 14:20:59.097462
+select * from verification_phone_verifications where verification_id = 149376;

# 2018-07-26 14:21:06.339080
+select * from verification_address_verifications where verification_id = 84289;

# 2018-07-26 14:21:13.717317
+select * from verification_phone_verifications where verification_id = 84289;

# 2018-07-26 14:22:50.829826
+select user_id, count(1) from verifications where state = 0 group by user_id having count(1) > 1;

# 2018-07-26 14:28:12.982003
+select v.id from verifications v left outer join verifications_address_verifications vav on v.id = vav.verification_id left outer join verifications_phone_verifications vpv on v.id = vpv.verification_id where v.state = 0 and (vav.id is null or vpv.id is null) limit 10;

# 2018-07-26 14:28:33.242435
+select v.id from verifications v left outer join verification_address_verifications vav on v.id = vav.verification_id left outer join verification_phone_verifications vpv on v.id = vpv.verification_id where v.state = 0 and (vav.id is null or vpv.id is null) limit 10;

# 2018-07-26 14:28:47.331201
+select v.id from verifications v left outer join verification_address_verifications vav on v.id = vav.verification_id left outer join verification_phone_verifications vpv on v.id = vpv.verification_id where v.state = 0 and vav.id is null and vpv.id is null limit 10;

# 2018-07-26 14:37:34.715959
+select v.id, v.state FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.id IS NULL
+      AND vpv.id IS NULL
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      )
+

# 2018-07-26 14:37:58.758523
+select * from verifications where user_id = 504023;

# 2018-07-26 14:38:07.546997
+select v.id, v.state FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.id IS NULL
+      AND vpv.id IS NULL
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      )
+

# 2018-07-26 14:38:21.870935
+select * from verifications where user_id = 425601;

# 2018-07-26 14:39:01.595311
+select * from verification_address_verifications where verification_id in (71212, 152610);

# 2018-07-26 14:39:50.317195
+select * from verification_phone_verifications where verification_id in (71212, 152610);

# 2018-07-26 14:41:22.053959
+select * from verifications where user_id = 555828;

# 2018-07-26 14:41:40.429649
+select * from verification_address_verifications where verification_id in (91367, 162167);

# 2018-07-26 14:41:49.513601
+select * from verification_phone_verifications where verification_id in (91367, 162167);

# 2018-07-26 14:43:54.627479
+select v.id, v.state FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE (vav.id IS NULL AND vpv.id IS NULL)
+      OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+      OR (vav.id IS NULL AND vpv.id IS NOT NULL)
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 14:44:54.671381
+SELECT user_id
+                                   FROM verifications
+                                   WHERE state = 0
+                                   GROUP BY user_id
+                                   HAVING COUNT(1) > 1;

# 2018-07-26 14:45:27.397042
+select v.id, v.state FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE ((vav.id IS NULL AND vpv.id IS NULL)
+        OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+        OR (vav.id IS NULL AND vpv.id IS NOT NULL))
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 14:50:34.164521
+select id, state from verifications where id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+;

# 2018-07-26 14:55:42.471602
+select id, state from verifications where id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+      AND id IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+      );

# 2018-07-26 14:56:02.019542
+select * from verifications where id id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+      AND id IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+      );

# 2018-07-26 14:56:11.706549
+select * from verifications where id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+      AND id IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+      );

# 2018-07-26 14:58:22.402067
+select * from verifications where id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+      AND id IN (
+        SELECT id FROM verifications v
+        INNER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+        INNER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+      );

# 2018-07-26 14:58:53.841025
+select * from verifications WHERE id NOT IN (
+        SELECT id FROM verifications v
+        WHERE user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+        ORDER BY updated_at DESC
+        LIMIT 1
+      )
+      AND id IN (
+        SELECT v.id FROM verifications v
+        INNER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+        INNER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+        WHERE v.user_id IN (
+          SELECT user_id
+          FROM verifications
+          WHERE state = 0
+          GROUP BY user_id
+          HAVING COUNT(1) > 1
+        )
+      );

# 2018-07-26 15:09:09.566030
+`select user_id, count(1) from verifications where state = 0 group by user_id having count(1) > 1;

# 2018-07-26 15:09:14.940261
+select user_id, count(1) from verifications where state = 0 group by user_id having count(1) > 1;

# 2018-07-26 15:13:31.017605
+select * from verifications where user_id = 555828;

# 2018-07-26 15:13:46.049942
+update verifications set state = 0 where user_id = 555828;

# 2018-07-26 15:13:52.700040
+update verifications set state = 0 where user_id = 425601;

# 2018-07-26 15:13:58.305666
+update verifications set state = 0 where user_id = 504023;

# 2018-07-26 15:14:34.399723
+update verifications set state = 0 where user_id in (425601, 504023, 555828);

# 2018-07-26 15:14:44.933953
+select * from verifications where user_id in (425601, 504023, 555828);

# 2018-07-26 15:15:00.800246
+UPDATE verifications SET state = 2
+      FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE ((vav.id IS NULL AND vpv.id IS NULL)
+        OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+        OR (vav.id IS NULL AND vpv.id IS NOT NULL))
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 15:15:23.006921
+select * from verifications where user_id in (425601, 504023, 555828);

# 2018-07-26 15:15:34.850374
+select count(1) from verifications where state = 0;

# 2018-07-26 15:20:01.155587
+update verifications set state = 0 where user_id in (425601, 504023, 555828);

# 2018-07-26 15:20:18.745984
+UPDATE verifications v SET state = 2
+      FROM verification_address_verifications vav
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE v.id = vav.verification_id
+      WHERE ((vav.id IS NULL AND vpv.id IS NULL)
+        OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+        OR (vav.id IS NULL AND vpv.id IS NOT NULL))
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 15:20:31.961088
+UPDATE verifications v SET state = 2
+      FROM verification_address_verifications vav
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE v.id = vav.verification_id
+      AND ((vav.id IS NULL AND vpv.id IS NULL)
+        OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+        OR (vav.id IS NULL AND vpv.id IS NOT NULL))
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 15:21:28.727660
+UPDATE verifications uv SET state = 2
+      FROM verifications v
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE uv.id = v.id
+      AND ((vav.id IS NULL AND vpv.id IS NULL)
+        OR (vav.id IS NOT NULL AND vpv.id IS NULL)
+        OR (vav.id IS NULL AND vpv.id IS NOT NULL))
+      AND v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      );

# 2018-07-26 15:21:47.022574
+select * from verifications where user_id in (425601, 504023, 555828);

# 2018-07-26 15:22:11.930483
+UPDATE verifications SET state = 2
+    WHERE id NOT IN (
+      SELECT id FROM verifications v
+      WHERE user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      )
+      ORDER BY updated_at DESC
+      LIMIT 1
+    )
+    AND id IN (
+      SELECT v.id FROM verifications v
+      INNER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      INNER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE v.user_id IN (
+        SELECT user_id
+        FROM verifications
+        WHERE state = 0
+        GROUP BY user_id
+        HAVING COUNT(1) > 1
+      )
+    );

# 2018-07-26 15:23:09.386359
+update verifications set state = 0 where user_id in (425601, 504023, 555828);

# 2018-07-26 15:23:40.122908
+select * from verifications where user_id in (425601, 504023, 555828);

# 2018-07-26 15:51:21.181124
+select vav.verified = 1 and vpv.verified = 1 as verified from users u inner join verifications v on u.id = v.user_id inner join verification_address_verifications vav on v.id = vav.verification_id inner join verification_phone_verifications vpv on v.id = vpv.verification_id order by random() limit 10;

# 2018-07-26 15:52:14.526071
+select vav.verified = true and vpv.verified = true as verified from users u inner join verifications v on u.id = v.user_id inner join verification_address_verifications vav on v.id = vav.verification_id inner join verification_phone_verifications vpv on v.id = vpv.verification_id order by random() limit 10;

# 2018-07-26 16:29:41.965160
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-07-01' and '2018-07-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.verified != TRUE OR vpv.verified != TRUE

# 2018-07-26 16:29:56.170559
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.verified != TRUE OR vpv.verified != TRUE

# 2018-07-26 16:30:05.780310
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-04-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.verified != TRUE OR vpv.verified != TRUE

# 2018-07-26 16:30:55.987935
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-04-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.verified != TRUE OR vpv.verified != TRUE

# 2018-07-26 16:31:04.966384
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE vav.verified != TRUE OR vpv.verified != TRUE

# 2018-07-26 16:32:00.260010
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:32:31.840112
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-29' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:32:36.754047
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-28' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:32:41.986789
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-27' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:32:46.741383
+SELECT u.firstname, u.surname, u.email
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:33:09.546364
+SELECT u.firstname, u.surname, u.email, v.id, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:33:20.633707
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (v.state = 0 AND vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:33:58.401777
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (vav.verified = TRUE AND vpv.verified = TRUE) AND v.state <> 0

# 2018-07-26 16:35:05.069903
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:35:10.122151
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+      WHERE NOT (vav.verified = TRUE AND vpv.verified = TRUE)

# 2018-07-26 16:36:05.897559
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND v.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND v.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 16:36:17.592963
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-01' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND vav.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND vpv.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 16:36:27.740671
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-20' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND vav.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND vpv.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 16:36:45.447414
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-28' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND vav.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND vpv.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 16:36:50.100068
+SELECT u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-26' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND vav.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND vpv.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 16:36:58.947128
+SELECT u.id, u.firstname, u.surname, u.email, v.id, v.state, vav.verified, vpv.verified
+      FROM users u
+      INNER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN '2018-06-26' and '2018-06-30'
+      LEFT OUTER JOIN verifications v ON u.id = v.user_id AND v.state = 0
+      LEFT OUTER JOIN verification_address_verifications vav ON v.id = vav.verification_id AND vav.verified = TRUE
+      LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id AND vpv.verified = TRUE
+      WHERE v.id IS NULL OR vav.id IS NULL OR vpv.id IS NULL

# 2018-07-26 17:12:57.372025
+select null = true and false = true as verified;

# 2018-07-26 17:13:03.684872
+select null = true and null = true as verified;

# 2018-07-26 17:19:52.513320
+select coalesce(null = true and null = true, false) as verified;

# 2018-07-27 17:10:43.375329
+\q

# 2018-07-30 10:24:52.603810
+select count(1) from verifications where verified = 1;

# 2018-07-30 10:25:14.154021
+select count(1) from verification_address_verifications where verified = 1;

# 2018-07-30 10:25:18.246530
+select count(1) from verification_address_verifications where verified = true;

# 2018-07-30 10:25:23.989034
+select count(1) from verification_address_verifications where verified = false;

# 2018-07-30 10:40:03.881088
+exit

# 2018-07-31 13:59:40.410321
+select count(1) from subscriptions where user_id = 1123125;

# 2018-07-31 13:59:48.126779
+select * from subscriptions where user_id = 1123125;

# 2018-07-31 13:59:56.495167
+delete from subscriptions where user_id = 1123125;

# 2018-08-01 10:47:12.089845
+select s.created_at from subscriptions s order by random() limit 1;

# 2018-08-01 10:47:23.272396
+\d subscriptions;

# 2018-08-01 10:49:09.532145
+select user_id, count(1) from subscriptions group by user_id having count(1) > 1 order by count(1) desc limit 10;

# 2018-08-01 10:49:24.532648
+select * from subscriptions where user_id = 141773;

# 2018-08-01 10:49:58.613703
+select * from subscriptions where user_id = 141773 order by created_at desc;

# 2018-08-01 10:51:36.601828
+select id, created_at::date from subscriptions where user_id = 141773 order by created_at desc;

# 2018-08-01 10:52:11.890518
+select s.id, s.created_at::date from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:52:25.554609
+select s.id, s.created_at::date, u.created_at::date from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:53:08.485021
+select s.id, s.created_at::date, u.created_at::date, s.created_at::date - u.created_at::date as diff from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:53:41.796030
+select s.id, s.created_at::date, date_trunc('day', u.created_at), s.created_at::date - u.created_at::date as diff from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:54:05.374536
+select s.id, s.created_at::date, date_trunc('day', u.created_at)::date, s.created_at::date - u.created_at::date as diff from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:54:22.389522
+select s.id, s.created_at, date_trunc('day', u.created_at)::date, s.created_at::date - u.created_at::date as diff from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 10:55:27.586837
+select s.id, s.created_at, date_trunc('day', u.created_at)::date, s.created_at::date - u.created_at::date as diff1, s.created_at - u.created_at as diff2 from subscriptions s inner join users u on s.user_id = u.id where s.user_id = 141773 order by s.created_at desc;

# 2018-08-01 11:13:12.183814
+select
+  u.created_at::date,
+  count(case when round(s.created_at - u.created_at) = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:14:08.467283
+select round(42.4);

# 2018-08-01 11:15:02.185896
+select
+  u.created_at::date,
+  count(case when date_trunc('day', s.created_at - u.created_at) = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:15:48.843684
+select
+  u.created_at::date,
+  count(case when date_trunc('day', s.created_at - u.created_at)::int = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:17:28.974111
+select
+  u.created_at::date,
+  count(case when extract('day', date_trunc('day', s.created_at - u.created_at)) = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:17:49.350380
+select
+  u.created_at::date,
+  count(case when extract(day from date_trunc('day', s.created_at - u.created_at)) = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:20:43.597172
+select
+  u.created_at::date,
+  sum(case when extract(day from date_trunc('day', s.created_at - u.created_at)) = 1 then 1 else 0 end) as sub_count
+from
+  users u
+  inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:22:44.309976
+select u.id, u.created_at, s.created_at from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:23:08.799954
+select u.id, u.created_at, s.created_at, extract(day from date_trunc('day', s.created_at - u.created_at)) as diff from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:24:11.458210
+select u.id, u.created_at, s.created_at, date_trunc('day', s.created_at - u.created_at) as diff from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:24:59.560373
+select u.id, u.created_at, s.created_at, s.created_at - u.created_at as diff from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:26:20.399300
+select u.id, u.created_at, s.created_at, s.created_at - u.created_at as diff, interval'1 day' from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:27:09.728622
+select u.id, u.created_at, s.created_at, (s.created_at - u.created_at) between interval'1 day' and interval'2 days' as diff from users u inner join subscriptions s on u.id = s.user_id where u.created_at between '2018-05-01' and '2018-05-31' order by u.created_at, s.created_at limit 10;

# 2018-08-01 11:29:13.884879
+select
+  u.created_at::date,
+  date_trunc('day', u.created_at) as substart,
+  date_trunc('day', u.created_at) + interval'1 day' as subend
+from users u
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date;

# 2018-08-01 11:29:35.668068
+select
+  u.created_at::date,
+  date_trunc('day', u.created_at) as substart,
+  date_trunc('day', u.created_at) + interval'1 day' as subend
+from users u
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date, u.created_at

# 2018-08-01 11:29:55.310721
+select
+  u.created_at::date,
+  date_trunc('day', u.created_at) as substart,
+  date_trunc('day', u.created_at) + interval'1 day' as subend
+from users u
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date, u.created_at
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:32:26.827630
+select
+  u.created_at::date,
+  count(s.id) as sub_count
+from users u
+left outer join subscriptions s on s.created_at between u.created_at and (u.created_at + interval'1 day')
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:33:40.429341
+select
+  u.created_at::date,
+  count(s.id) as sub_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:37:22.363234
+select
+  u.id,
+  u.created_at,
+  s.created_at,
+  s.created_at between u.created_at and (u.created_at + interval'1 day') as within
+from users u
+inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-02'
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:38:24.126824
+select
+  u.id,
+  u.created_at,
+  s.created_at,
+  s.created_at between u.created_at and (u.created_at + interval'1 day') as within
+from users u
+inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-02'
+order by u.created_at::date
+limit 50;

# 2018-08-01 11:38:43.864543
+select
+  u.id,
+  u.created_at,
+  s.created_at,
+  s.created_at between u.created_at and (u.created_at + interval'1 day') as within
+from users u
+inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-02'
+order by u.created_at
+limit 50;

# 2018-08-01 11:39:02.536018
+select
+  u.id,
+  u.created_at,
+  s.created_at,
+  s.created_at between u.created_at and (u.created_at + interval'1 day') as within
+from users u
+inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-02'
+order by u.created_at;

# 2018-08-01 11:39:50.202190
+select
+  u.id,
+  u.created_at,
+  s.id,
+  s.created_at,
+  s.created_at between u.created_at and (u.created_at + interval'1 day') as within
+from users u
+inner join subscriptions s on u.id = s.user_id
+where u.created_at between '2018-05-01' and '2018-05-02'
+order by u.created_at;

# 2018-08-01 11:41:52.039022
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:45:46.584502
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when s.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when s.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:46:20.904014
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 11:49:08.454479
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between (u.created_at + interval'1 day') and (u.created_at + interval'2 days')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 12:07:45.316525
+\q

# 2018-08-01 12:19:09.522722
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between (u.created_at + interval'1 day') and (u.created_at + interval'2 days')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-05-01' and '2018-05-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 12:19:34.433234
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-20' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 12:59:37.424501
+select * from metrics limit 10;

# 2018-08-01 12:59:53.833505
+select * from metrics order by created_at desc limit 10;

# 2018-08-01 13:05:06.233605
+select * from payments order by created_at desc limit 10;

# 2018-08-01 13:13:45.175481
+select search_params from verification_address_verification_id3_search_results order by created_at desc limit 10;

# 2018-08-01 13:14:03.297470
+select search_param from verification_address_verification_id3_search_results order by created_at desc limit 10;

# 2018-08-01 13:14:34.601964
+select address_hash from verification_address_verification_id3_search_results order by created_at desc limit 10;

# 2018-08-01 13:49:23.362994
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE ((LOWER(u.firstname || ' ' || u.surname) LIKE '%dave%') OR LOWER(u.surname) LIKE '%dave%' OR LOWER(u.firstname) LIKE '%dave%')
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25

# 2018-08-01 13:49:25.018323
+;

# 2018-08-01 13:49:51.889518
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE ((LOWER(u.firstname || ' ' || u.surname) LIKE '%dave%') OR LOWER(u.surname) LIKE '%dave%' OR LOWER(u.firstname) LIKE '%dave%')
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25;

# 2018-08-01 13:50:31.874495
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE LOWER(u.surname) LIKE '%dave%' OR LOWER(u.firstname) LIKE '%dave%')
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25;

# 2018-08-01 13:50:44.273585
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE LOWER(u.surname) LIKE '%dave%' OR LOWER(u.firstname) LIKE '%dave%'
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25;

# 2018-08-01 13:51:20.035758
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE u.surname ILIKE '%dave%' OR u.firstname ILIKE '%dave%'
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25;

# 2018-08-01 13:52:25.989663
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE u.surname ILIKE '%dave%' OR u.firstname ILIKE '%dave%'
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 25

# 2018-08-01 13:53:38.414262
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE ((LOWER(u.firstname || ' ' || u.surname) LIKE '%dave burn%') OR LOWER(u.surname) LIKE '%dave burn%' OR LOWER(u.firstname) LIKE '%dave burn%')
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 0;

# 2018-08-01 13:54:12.368096
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE u.surname ILIKE '%dave burn%' OR u.firstname ILIKE '%dave burn%'
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 0;

# 2018-08-01 13:55:19.101476
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE (((u.firstname || ' ' || u.surname) ILIKE '%dave burn%') OR u.surname ILIKE '%dave burn%' OR u.firstname ILIKE '%dave burn%')
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY u.created_at DESC
+LIMIT 25 OFFSET 0;

# 2018-08-01 13:58:44.143300
+select u.id, u.firstname, u.surname from users u where u.firstname similar to '(dave|burn)';

# 2018-08-01 13:59:37.913314
+select u.id, u.firstname, u.surname from users u where u.firstname similar to '(dave|burn)' or u.lastname similar to '(dave|burn)';

# 2018-08-01 13:59:49.032156
+select u.id, u.firstname, u.surname from users u where u.firstname similar to '(dave|burn)' or u.surname similar to '(dave|burn)';

# 2018-08-01 14:00:49.763097
+select u.id, u.firstname, u.surname from users u where u.firstname ~* '(dave|burn)' or u.surname similar to '(dave|burn)';

# 2018-08-01 14:01:03.259516
+select u.id, u.firstname, u.surname from users u where u.firstname ~* '(dave|burn)' or u.surname similar to '(dave|burn)' limit 20;

# 2018-08-01 14:01:20.524821
+select u.id, u.firstname, u.surname from users u where u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)' limit 20;

# 2018-08-01 14:03:45.201135
+select u.id, u.firstname, u.surname from users u where u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)' order by levenshtein(u.firstname || ' ' || u.surname, 'dave burn') limit 20;

# 2018-08-01 14:04:42.082667
+select u.id, u.firstname, u.surname, levenshtein(u.firstname || ' ' || u.surname, 'dave burn') from users u where u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)' limit 20;

# 2018-08-01 14:05:55.355952
+create extension fuzzystrmatch;

# 2018-08-01 14:05:58.268691
+select u.id, u.firstname, u.surname, levenshtein(u.firstname || ' ' || u.surname, 'dave burn') from users u where u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)' limit 20;

# 2018-08-01 14:06:22.095638
+select u.id, u.firstname, u.surname, levenshtein(u.firstname || ' ' || u.surname, 'dave burn') from users u where u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)' order by levenshtein(u.firstname || ' ' || u.surname, 'dave burn') limit 20;

# 2018-08-01 14:15:36.862675
+SELECT
+  u.id AS user_id,
+  CONCAT_WS(' ', u.firstname, u.surname) AS name,
+  u.email,
+  u.created_at AS registration_date,
+  u.uuid AS user_uuid,
+  u.active AS user_active,
+  u.role > 0 AS user_administrator,
+  o.uuid AS owner_uuid,
+  o.hide AS hidden_owner_profile,
+  d.name AS dog_name,
+  d.uuid AS dog_uuid,
+  b.uuid AS borrower_uuid,
+  b.hide AS hidden_borrower_profile,
+  uc.marketing_permission,
+  s.id AS subscription_id,
+  s.id IS NOT NULL AS subscribed,
+  COALESCE(db.name, d.breed) AS dog_breed_name
+  , COUNT(1) OVER () AS total_count
+FROM
+  users u
+  INNER JOIN user_identities ui ON u.id = ui.user_id
+  INNER JOIN user_configurations uc ON u.id = uc.user_id
+  LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.state = 0
+  LEFT OUTER JOIN payments p ON u.id = p.user_id
+  LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.deleted_at IS NULL
+  LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.deleted_at IS NULL
+  LEFT OUTER JOIN dogs d ON o.id = d.owner_id AND d.active = TRUE
+  LEFT OUTER JOIN dog_breeds db ON db.id = d.dog_breed_id
+  LEFT OUTER JOIN verifications v ON v.user_id = u.id AND v.state = 0
+  LEFT OUTER JOIN verification_phone_verifications vpv ON v.id = vpv.verification_id
+WHERE u.firstname ~* '(dave|burn)' or u.surname ~* '(dave|burn)'
+GROUP BY u.id, o.uuid, o.hide, d.name, d.uuid, b.uuid, b.hide, uc.marketing_permission, s.id, d.breed, db.name
+ORDER BY levenshtein(u.firstname || ' ' || u.surname, 'dave burn'), u.created_at DESC
+LIMIT 25 OFFSET 0;

# 2018-08-01 14:17:54.939647
+clear

# 2018-08-01 14:18:17.671254
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-20' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-01 15:26:02.797506
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-20' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 20;

# 2018-08-01 16:09:14.409251
+select u.id, u.firstname, u.surname, levenshtein(u.firstname || ' ' || u.surname, 'dave burne') from users u where u.firstname ~* '(dave|burne)' or u.surname ~* '(dave|burne)' order by levenshtein(u.firstname || ' ' || u.surname, 'dave burne') limit 20;

# 2018-08-01 17:30:17.315219
+VACUUM VERBOSE;

# 2018-08-01 17:31:11.795312
+SELECT setting = 'on' AS enabled FROM pg_settings WHERE name = 'data_checksums';

# 2018-08-02 09:00:47.733232
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count
+from users u
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-01' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date;

# 2018-08-02 10:31:12.144504
+select * from user_iden

# 2018-08-02 10:31:15.666680
+select * from user_identities limit 1;

# 2018-08-02 10:32:18.625875
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count,
+  count(b.id) as total_borrower_count,
+  count(o.id) as total_owner_count
+from users u
+inner join user_identities ui on u.id = ui.user_id
+left outer join borrowers b on ui.id = b.user_identity_id
+left outer join owners o on ui.id = o.user_identity_id
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-01' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-02 10:32:51.500839
+select * from borrowers limit 1;

# 2018-08-02 10:33:17.430250
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count,
+  count(b.id) as total_borrower_count,
+  count(o.id) as total_owner_count
+from users u
+inner join user_identities ui on u.id = ui.user_id
+left outer join borrowers b on ui.id = b.user_identity_id and b.completed_at is not null
+left outer join owners o on ui.id = o.user_identity_id and o.completed_at is not null
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-01' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-02 10:37:15.213836
+select count(1) from borrowers where created_at between '2018-07-01' and '2018-07-02'

# 2018-08-02 10:37:23.300800
+select count(1) from borrowers where completed_at between '2018-07-01' and '2018-07-02'

# 2018-08-02 10:37:32.639644
+select count(1) from borrowers where created_at between '2018-07-01' and '2018-07-02' and completed_at is not null;

# 2018-08-02 10:38:34.727940
+select count(1) from owners where created_at between '2018-07-01' and '2018-07-02';

# 2018-08-02 10:38:50.351014
+select count(1) from owners where created_at between '2018-07-01' and '2018-07-02' and completed_at is not null;

# 2018-08-02 11:15:59.701969
+select
+  u.created_at::date,
+  count(s.id) as sub_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count,
+  count(u.id) as reg_count,
+  count(b.id) as total_borrower_count,
+  count(o.id) as total_owner_count
+from users u
+inner join user_identities ui on u.id = ui.user_id
+left outer join borrowers b on ui.id = b.user_identity_id
+left outer join owners o on ui.id = o.user_identity_id
+left outer join subscriptions s on u.id = s.user_id and s.created_at between u.created_at and (u.created_at + interval'1 day')
+left outer join subscription_plans sp on s.subscription_plan_id = sp.id
+where u.created_at between '2018-07-01' and '2018-07-31'
+group by
+  u.created_at::date
+order by u.created_at::date
+limit 10;

# 2018-08-02 13:28:04.176191
+SELECT
+        u.created_at::date AS reg_date,
+        COUNT(u.id) AS total_reg_count,
+        COUNT(b.id) AS total_borrower_count,
+        COUNT(o.id) AS total_owner_count,
+        COUNT(cb.id) AS completed_borrower_count,
+        COUNT(co.id) AS completed_owner_count
+      FROM users u
+      INNER JOIN user_identities ui ON u.id = ui.user_id
+      LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id
+      LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id
+      LEFT OUTER JOIN borrowers cb ON ui.id = cb.user_identity_id AND cb.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+      LEFT OUTER JOIN owners co ON ui.id = co.user_identity_id AND co.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+      WHERE u.created_at BETWEEN '2018-07-01' AND '2018-07-31'
+      GROUP BY
+        u.created_at::date
+      ORDER BY u.created_at::date
+

# 2018-08-02 13:32:41.140463
+SELECT
+   u.created_at::date AS reg_date,
+   COUNT(u.id) AS total_reg_count,
+   COUNT(b.id) AS total_borrower_count,
+   COUNT(o.id) AS total_owner_count,
+   COUNT(cb.id) AS completed_borrower_count,
+   COUNT(co.id) AS completed_owner_count,
+   SUM(CASE WHEN cb.id IS NULL AND co.id IS NULL THEN 0 ELSE 1 END) AS completed_total_count
+ FROM users u
+ INNER JOIN user_identities ui ON u.id = ui.user_id
+ LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id
+ LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id
+ LEFT OUTER JOIN borrowers cb ON ui.id = cb.user_identity_id AND cb.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+ LEFT OUTER JOIN owners co ON ui.id = co.user_identity_id AND co.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+ WHERE u.created_at BETWEEN '2018-07-01' AND '2018-07-31'
+ GROUP BY
+   u.created_at::date
+ ORDER BY u.created_at::date;

# 2018-08-02 13:33:08.531072
+SELECT
+   u.created_at::date AS reg_date,
+   COUNT(u.id) AS total_reg_count,
+   COUNT(b.id) AS total_borrower_count,
+   COUNT(o.id) AS total_owner_count,
+   COUNT(cb.id) AS completed_borrower_count,
+   COUNT(co.id) AS completed_owner_count,
+   SUM(CASE WHEN cb.id IS NULL AND co.id IS NULL THEN 0 ELSE 1 END) AS completed_total_count,
+   COUNT(cb.id) + COUNT(co.id) AS doublecount
+ FROM users u
+ INNER JOIN user_identities ui ON u.id = ui.user_id
+ LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id
+ LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id
+ LEFT OUTER JOIN borrowers cb ON ui.id = cb.user_identity_id AND cb.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+ LEFT OUTER JOIN owners co ON ui.id = co.user_identity_id AND co.completed_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+ WHERE u.created_at BETWEEN '2018-07-01' AND '2018-07-31'
+ GROUP BY
+   u.created_at::date
+ ORDER BY u.created_at::date

# 2018-08-02 13:35:02.505761
+select u.id, u.firstname, u.surname from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-04' and '2018-07-05' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 13:36:34.388709
+select u.id, u.firstname, u.surname from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-05' and '2018-07-06' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 13:36:47.036172
+select u.id, u.firstname, u.surname from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-06' and '2018-07-07' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 13:38:01.591795
+select u.id, u.firstname, u.surname, u.created_at, b.completed_at, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-06' and '2018-07-07' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 13:39:05.396867
+select u.id, u.firstname, u.surname, u.created_at, b.completed_at, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-07' and '2018-07-08' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 13:39:21.140651
+select u.id, u.firstname, u.surname, u.created_at, b.completed_at, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id inner join borrowers b on ui.id = b.user_identity_id inner join owners o on ui.id = o.user_identity_id where u.created_at between '2018-07-08' and '2018-07-09' and b.completed_at is not null and o.completed_at is not null order by b.completed_at, o.completed_at limit 10;

# 2018-08-02 14:00:52.079488
+select min(3, 4)

# 2018-08-02 14:10:21.982675
+SELECT
+        (CASE WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date AS completion_date,
+        COUNT(s.id) AS total_sub_count,
+        SUM(CASE WHEN sp.profile_type = 0 THEN 1 ELSE 0 END) AS borrower_sub_count,
+        SUM(CASE WHEN sp.profile_type = 1 THEN 1 ELSE 0 END) AS owner_sub_count,
+        COUNT(b.id) AS completed_borrower_count,
+        COUNT(o.id) AS completed_owner_count,
+        SUM(CASE WHEN b.id IS NULL AND o.id IS NULL THEN 0 ELSE 1 END) AS total_completed_count
+      FROM users u
+      INNER JOIN user_identities ui ON u.id = ui.user_id
+      LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+      LEFT OUTER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+      WHERE b.id IS NOT NULL OR o.id IS NOT NULL
+      GROUP BY
+        (CASE WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date
+      ORDER BY 1 limit 10;

# 2018-08-02 14:11:50.622302
+SELECT
+        (CASE WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date AS completion_date,
+        COUNT(s.id) AS total_sub_count,
+        SUM(CASE WHEN sp.profile_type = 0 THEN 1 ELSE 0 END) AS borrower_sub_count,
+        SUM(CASE WHEN sp.profile_type = 1 THEN 1 ELSE 0 END) AS owner_sub_count,
+        COUNT(b.id) AS completed_borrower_count,
+        COUNT(o.id) AS completed_owner_count,
+        SUM(CASE WHEN b.id IS NULL AND o.id IS NULL THEN 0 ELSE 1 END) AS total_completed_count
+      FROM users u
+      INNER JOIN user_identities ui ON u.id = ui.user_id
+      LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+      LEFT OUTER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+      WHERE b.id IS NOT NULL OR o.id IS NOT NULL
+      GROUP BY
+        (CASE WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date
+      ORDER BY 1;

# 2018-08-02 14:14:32.819470
+SELECT
+        (CASE WHEN b.completed_at IS NULL THEN o.completed_at WHEN o.completed_at IS NULL THEN b.completed_at WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date AS completion_date,
+        COUNT(s.id) AS total_sub_count,
+        SUM(CASE WHEN sp.profile_type = 0 THEN 1 ELSE 0 END) AS borrower_sub_count,
+        SUM(CASE WHEN sp.profile_type = 1 THEN 1 ELSE 0 END) AS owner_sub_count,
+        COUNT(b.id) AS completed_borrower_count,
+        COUNT(o.id) AS completed_owner_count,
+        SUM(CASE WHEN b.id IS NULL AND o.id IS NULL THEN 0 ELSE 1 END) AS total_completed_count
+      FROM users u
+      INNER JOIN user_identities ui ON u.id = ui.user_id
+      LEFT OUTER JOIN borrowers b ON ui.id = b.user_identity_id AND b.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN owners o ON ui.id = o.user_identity_id AND o.completed_at BETWEEN '2018-07-01 00:00:00 +0100' AND '2018-07-31 23:59:59 +0100'
+      LEFT OUTER JOIN subscriptions s ON u.id = s.user_id AND s.created_at BETWEEN u.created_at AND (u.created_at + interval'1 days')
+      LEFT OUTER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+      WHERE b.id IS NOT NULL OR o.id IS NOT NULL
+      GROUP BY
+        (CASE WHEN b.completed_at IS NULL THEN o.completed_at WHEN o.completed_at IS NULL THEN b.completed_at WHEN b.completed_at < o.completed_at THEN b.completed_at ELSE o.completed_at END)::date
+      ORDER BY 1

# 2018-08-02 14:15:53.188074
+select count(1) from borrowers where completed_at between '2018-07-01' and '2018-07-02'

# 2018-08-02 14:16:46.099142
+select count(1) from owners where completed_at between '2018-07-01' and '2018-07-02'

# 2018-08-02 14:21:58.717361
+select b.id, b.completed_at, o.id, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id left outer join borrowers b on ui.id = b.user_identity_id and b.completed_at between '2018-07-01' and '2017-07-02' left outer join owners o on ui.id = o.user_identity_id and o.completed_at between '2018-07-01' and '2017-07-02' where b.id is not null or o.id is not null limit 10;

# 2018-08-02 14:22:33.703713
+select b.id, b.completed_at, o.id, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id left outer join borrowers b on ui.id = b.user_identity_id and b.completed_at between '2018-07-04' and '2018-07-05' left outer join owners o on ui.id = o.user_identity_id and o.completed_at between '2018-07-04' and '2018-07-05' where b.id is not null or o.id is not null limit 10;

# 2018-08-02 14:22:44.421078
+select b.id, b.completed_at, o.id, o.completed_at from users u inner join user_identities ui on u.id = ui.user_id left outer join borrowers b on ui.id = b.user_identity_id and b.completed_at between '2018-07-04' and '2018-07-05' left outer join owners o on ui.id = o.user_identity_id and o.completed_at between '2018-07-04' and '2018-07-05' where b.id is not null or o.id is not null limit 30;

# 2018-08-02 14:26:07.917171
+select b.id, b.completed_at, o.id, o.completed_at, least(b.completed_at, o.completed_at)  from users u inner join user_identities ui on u.id = ui.user_id left outer join borrowers b on ui.id = b.user_identity_id and b.completed_at between '2018-07-04' and '2018-07-05' left outer join owners o on ui.id = o.user_identity_id and o.completed_at between '2018-07-04' and '2018-07-05' where b.id is not null or o.id is not null limit 30;

# 2018-08-03 13:49:06.706479
+select date'2018-08-04' = date();

# 2018-08-03 13:49:15.503151
+select date'2018-08-04' = today();

# 2018-08-03 13:50:14.079926
+select date'2018-08-04' = date'today';

# 2018-08-03 13:50:19.509844
+select date'today';

# 2018-08-03 13:50:25.318533
+select date'2018-08-03' = date'today';

# 2018-08-03 13:51:41.963234
+\d verification_address_verifications;

# 2018-08-03 14:30:52.018192
+select * from subscriptions where user_id = 

# 2018-08-03 14:30:54.947805
+select * from subscriptions where user_id = 141773 order by created_at desc;

# 2018-08-03 14:31:32.960478
+select * from subscriptions where user_id = 1146177;

# 2018-08-03 14:32:22.675576
+update subscriptions set current_period_ends_at = '2018-08-02 23:59:59.999999' where user_id = 1146177;

# 2018-08-03 16:56:59.250424
+\q

# 2018-08-08 15:29:39.123685
+delete from delayed_jobs where created_at = '2018-08-08 14:25:05.520557';

# 2018-08-08 15:29:42.898980
+\q

# 2018-08-08 17:12:20.543100
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE s.created_at < '2018-01-01';

# 2018-08-08 17:16:30.835744
+\d subscriptions

# 2018-08-08 17:17:28.197247
+select user_id, count(1) from subscriptions group by user_id having count(1) > 1 order by count(1) desc limit 10;

# 2018-08-08 17:17:39.501399
+select * from subscriptions where user_id = 1146177;

# 2018-08-08 17:17:46.213865
+select * from subscriptions where user_id = 141773;

# 2018-08-08 17:17:57.335201
+select * from subscriptions where user_id = 141773 order by created_at desc;

# 2018-08-08 17:24:09.450177
+SELECT
+  u.created_at::date AS reg_date,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  users u
+  INNER JOIN subscriptions s ON u.created_at::date BETWEEN s.created_at::date AND s.current_period_ends_at::date
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE u.created_at < '2018-01-01' AND u.created_at > '2017-12-20'
+LIMIT 10;

# 2018-08-08 17:24:32.612560
+SELECT
+  u.created_at::date AS reg_date,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  users u
+  INNER JOIN subscriptions s ON u.created_at::date BETWEEN s.created_at::date AND s.current_period_ends_at::date
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE u.created_at::date < '2018-01-01' AND u.created_at::date > '2017-12-20'
+GROUP BY u.created_at::date
+LIMIT 10;

# 2018-08-08 17:27:56.319532
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE s.created_at::date BETWEEN '2018-07-01' AND '2018-07-02'
+LIMIT 10

# 2018-08-08 17:28:29.664838
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE '2018-07-01' BETWEEN s.created_at AND s.current_period_ends_at
+LIMIT 10;

# 2018-08-09 09:59:09.109483
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE '2018-07-01' BETWEEN s.created_at AND s.current_period_ends_at
+LIMIT 10

# 2018-08-09 10:03:46.309611
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE s.created_at < datetime'2018-07-31T23:59:59'
+AND s.current_period_ends_at > datetime'2018-07-01T00:00:00'
+LIMIT 10;

# 2018-08-09 10:04:17.119200
+SELECT
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  subscriptions s
+  INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+WHERE s.created_at < timestamp'2018-07-31T23:59:59'
+AND s.current_period_ends_at > timestamp'2018-07-01T00:00:00'
+LIMIT 10;

# 2018-08-09 10:09:50.923446
+select * from generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month');

# 2018-08-09 10:10:32.430291
+select * from generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month' - interval'1 second');

# 2018-08-09 10:11:45.651317
+select * from generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') as months(month_start);

# 2018-08-09 10:13:36.269683
+select ms.month_start, ms.month_start + interval'1 month' as month_end from generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') as ms(month_start);

# 2018-08-09 10:13:54.209589
+select ms.month_start, ms.month_start + interval'1 month' - interval'1 second' as month_end from generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') as ms(month_start);

# 2018-08-09 10:17:11.367277
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+LIMIT 12;

# 2018-08-09 10:17:23.973323
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+LIMIT 12;

# 2018-08-09 10:18:17.255251
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start
+LIMIT 12;

# 2018-08-09 10:18:54.693474
+select min(created_at) from subscriptions;

# 2018-08-09 10:20:27.537504
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  sum(case when sp.profile_type = 0 then 1 else 0 end) as borrower_count,
+  sum(case when sp.profile_type = 1 then 1 else 0 end) as owner_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-07-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:31:03.667396
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-07-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:38:39.369374
+select daterange'[2018-07-01,2018-08-01)';

# 2018-08-09 10:39:36.231960
+select daterange('2018-07-01', '2018-08-01', '[)')

# 2018-08-09 10:40:08.010904
+select timestamp'2018-07-15T12:34:00' && daterange('2018-07-01', '2018-08-01', '[)')

# 2018-08-09 10:43:32.194374
+SELECT
+  daterange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON daterange(s.created_at, s.current_period_ends_at, '[]') && daterange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:44:18.783645
+SELECT
+  daterange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON tsrange(s.created_at, s.current_period_ends_at, '[]') && daterange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:44:44.216204
+select date'2018-08-03';

# 2018-08-09 10:44:54.363031
+SELECT
+  daterange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(date'2017-01-01', date'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON tsrange(s.created_at, s.current_period_ends_at, '[]') && daterange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:45:21.350655
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end
+FROM
+  generate_series(date'2017-01-01', date'2017-12-01', interval'1 month') AS ms(month_start);

# 2018-08-09 10:45:48.399910
+SELECT
+  tsrange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON tsrange(s.created_at, s.current_period_ends_at, '[]') && daterange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:46:02.943070
+SELECT
+  tsrange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON tsrange(s.created_at, s.current_period_ends_at, '[]') && tsrange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:47:14.420249
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2017-01-01', timestamp'2017-12-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month' - interval'1 second') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:49:19.282356
+SELECT
+  tsrange(ms.month_start, ms.month_start + interval'1 month', '[)') AS month_range,
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' - interval'1 second' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON tsrange(s.created_at, s.current_period_ends_at, '[]') && tsrange(ms.month_start, ms.month_start + interval'1 month', '[)')
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:51:23.431092
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start

# 2018-08-09 10:52:42.805317
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(date'2013-01-01', date'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:55:32.775698
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(s.id) AS total_subscription_count,
+  SUM(1 - sp.profile_type) AS borrower_count,
+  SUM(sp.profile_type) AS owner_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN subscriptions s ON s.created_at < (ms.month_start + interval'1 month') AND s.current_period_ends_at > ms.month_start
+INNER JOIN subscription_plans sp ON s.subscription_plan_id = sp.id
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 10:58:18.567448
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(u.id) AS total_user_count
+FROM
+  generate_series(timestamp'2013-01-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN users u ON u.created_at BETWEEN ms.month_start AND (ms.month_start + interval'1 month')
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 11:02:53.079676
+select min(created_at) from users;

# 2018-08-09 11:03:06.812324
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(u.id) AS total_user_count
+FROM
+  generate_series(timestamp'2012-07-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN users u ON u.created_at BETWEEN ms.month_start AND (ms.month_start + interval'1 month')
+GROUP BY ms.month_start
+ORDER BY ms.month_start

# 2018-08-09 11:06:59.838767
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(u.id) AS total_user_count
+FROM
+  generate_series(timestamp'2012-07-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN users u ON u.created_at < ms.month_start + interval'1 month')
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 11:07:10.443283
+SELECT
+  ms.month_start AS month_start,
+  ms.month_start + interval'1 month' AS month_end,
+  COUNT(u.id) AS total_user_count
+FROM
+  generate_series(timestamp'2012-07-01', timestamp'2018-08-01', interval'1 month') AS ms(month_start)
+INNER JOIN users u ON u.created_at < ms.month_start + interval'1 month'
+GROUP BY ms.month_start
+ORDER BY ms.month_start;

# 2018-08-09 11:10:49.475194
+select count(1) from users;

# 2018-08-09 11:20:16.744655
+select * from metrics limit 10;

# 2018-08-09 12:02:14.796929
+\d subscriptions

# 2018-08-10 13:21:43.553952
+\d verifications

# 2018-08-10 13:21:59.696140
+\d verification_address_verifications

# 2018-08-10 16:34:50.562298
+\q

# 2018-08-21 15:09:34.152176
+delete from borrowers where id = 829555;

# 2018-08-21 15:09:53.950688
+select * from user_identities where id = 1147091;

# 2018-08-21 15:10:55.883289
+select * from users where id = 1164108;

# 2018-08-21 15:13:38.278987
+\q

# 2018-08-21 16:20:00.851009
+delete from borrowers where id = 829613;

# 2018-08-21 16:20:54.245738
+delete from user_identities where id = 1147169;

# 2018-08-21 16:39:49.523510
+select u.id, u.firstname, u.surname, count(dt.token)
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+group by u.id, u.firstname, u.surname
+where u.created_at > '2018-08-21T13:35:00'
+limit 100;

# 2018-08-21 16:40:03.637711
+select u.id, u.firstname, u.surname, count(dt.token)
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00'
+group by u.id, u.firstname, u.surname
+limit 100;

# 2018-08-21 16:43:25.003473
+select u.id, u.uuid, u.firstname, u.surname, count(dt.token)
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00'
+group by u.id, u.firstname, u.surname
+limit 100;

# 2018-08-21 16:43:41.067389
+select u.id, u.uuid, u.firstname, u.surname, count(dt.token), u.created_at
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00'
+group by u.id, u.firstname, u.surname
+limit 100;

# 2018-08-21 16:43:52.741669
+select u.id, u.uuid, u.firstname, u.surname, count(dt.token), u.created_at
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00'
+group by u.id, u.firstname, u.surname
+order by u.created_at
+limit 100;

# 2018-08-21 16:50:30.375187
+select u.id, u.uuid, u.firstname, u.surname, count(dt.token), u.created_at
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00+0000'
+group by u.id, u.firstname, u.surname
+order by u.created_at
+limit 100;

# 2018-08-21 17:59:54.605135
+\q

# 2018-08-22 09:48:02.821724
+select u.id, u.uuid, u.firstname, u.surname, count(dt.token), u.created_at
+from users u
+inner join user_authentication_providers uap on u.id = uap.user_id and uap.facebook_uid is not null
+left outer join device_tokens dt on u.id = dt.user_id
+where u.created_at > '2018-08-21T13:35:00+0000'
+group by u.id, u.firstname, u.surname
+order by u.created_at
+limit 100;

# 2018-08-22 09:48:16.270413
+\q

# 2018-08-22 10:20:41.580689
+select * from user_authentication_providers where facebook_uid = '10208733184350735';

# 2018-08-22 10:27:27.205648
+\q

# 2018-08-23 13:24:25.372138
+select count(1) from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where s.current_period_ends_at < now() and v.state = 0;

# 2018-08-23 13:25:26.453148
+select u.id, u.uuid, u.email, s.current_period_ends_at, v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where s.current_period_ends_at < now() and v.state = 0 limit 10;

# 2018-08-23 13:25:45.040092
+select u.id, u.uuid, u.email, s.current_period_ends_at, v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where s.current_period_ends_at < now() and v.state = 0 and u.deleted_at is null limit 10;

# 2018-08-23 13:27:00.876338
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() limit 10;

# 2018-08-23 13:31:42.820146
+select count(1)from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() limit 10;

# 2018-08-23 13:31:55.978987
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() limit 10;

# 2018-08-23 13:32:00.007169
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() limit 100;

# 2018-08-23 13:45:46.423004
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) limit 100;

# 2018-08-23 13:56:12.150133
+select * from subscriptions where user_id = 5052;

# 2018-08-23 13:58:03.989075
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at desc) limit 100;

# 2018-08-23 13:58:11.383824
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) desc limit 100;

# 2018-08-23 14:04:33.621487
+select * from subscriptions where user_id = 855719;

# 2018-08-23 14:05:23.368257
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) desc limit 100;

# 2018-08-23 14:06:22.929604
+select * from subscriptions where user_id = 854309;

# 2018-08-23 14:07:18.842839
+u.active

# 2018-08-23 14:16:55.321254
+select * from subscriptions where user_id = 854309;

# 2018-08-23 14:27:19.386501
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) desc limit 100;

# 2018-08-23 14:28:27.463731
+select * from subscriptions where user_id = 839593;

# 2018-08-23 14:31:38.833565
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null and s.state = 2 group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) desc limit 100;

# 2018-08-23 14:31:55.244833
+select u.id, u.uuid, u.email, max(s.current_period_ends_at), v.state from users u inner join subscriptions s on u.id = s.user_id inner join verifications v on u.id = v.user_id where v.state = 0 and u.deleted_at is null and s.state = 2 group by u.id, u.uuid, u.email, v.state having max(s.current_period_ends_at) < now() order by max(s.current_period_ends_at) desc limit 200;

# 2018-08-23 14:33:54.893270
+select * from subscriptions where user_id = 787538;

# 2018-08-23 14:35:05.356037
+select count(1) from subscriptions where state = 2;

# 2018-08-23 14:40:08.647825
+select * from payments where user_id = 787538;

# 2018-08-23 14:41:43.102714
+select * from subscriptions where user_id = 787538;

# 2018-08-23 14:43:02.012486
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at
+from subscriptions s
+inner join users u on s.user_id = u.id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 14:44:41.202279
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state, vav.verified, vpv.verified
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 14:45:04.935817
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state, vav.verified as address_verified, vpv.verified as phone_verified
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 14:46:42.397927
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 14:50:53.331427
+COPY (
+  select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc
+  ) TO STDOUT with CSV HEADER

# 2018-08-23 15:03:05.917431
+select count(1) from subscriptions where state = 0 and current_period_ends_at < today()

# 2018-08-23 15:03:11.684000
+select count(1) from subscriptions where state = 0 and current_period_ends_at < now()

# 2018-08-23 15:03:51.059951
+select count(1) from subscriptions where state = 0 and current_period_ends_at < now()::date

# 2018-08-23 15:04:19.054010
+select * from subscriptions where state = 0 and current_period_ends_at < now()::date order by current_period_ends_at desc limit 20

# 2018-08-23 15:06:20.068985
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 15:06:31.123515
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-23 15:11:16.713986
+select * from subscriptions where state = 0 and current_period_ends_at < now()::date order by current_period_ends_at desc limit 20

# 2018-08-23 17:08:15.517889
+\q

# 2018-08-24 09:58:23.271512
+select * from subscriptions where state = 0 and current_period_ends_at < now()::date order by current_period_ends_at desc limit 20;

# 2018-08-24 11:08:32.932670
+select count(1) from subscriptions where state = 0 and current_period_ends_at < now()::date;

# 2018-08-24 12:14:28.024353
+select * from users where email = 'maisiesaves@gmail.com';

# 2018-08-24 12:14:44.390909
+select * from subscriptions where user_id = 819458;

# 2018-08-24 12:14:56.787639
+select * from recurring_billing_resources where subscription_id = 146048;

# 2018-08-24 12:16:01.357473
+select * from stripe_payment_log limit 10;

# 2018-08-24 12:20:23.239147
+select * from payments where provider_transaction_id = 'ch_DQeJ6wjGT0P3Q1';

# 2018-08-24 12:21:09.240983
+select * from payments where provider_transaction_id = 'ch_BChpNaLrZytQwT';

# 2018-08-24 12:24:15.209471
+select * from stripe_payment_log limit 10;

# 2018-08-24 12:24:31.588212
+select * from stripe_payment_log order by created_at desc limit 10;

# 2018-08-24 12:44:01.810933
+select * from subscription_re

# 2018-08-24 12:44:08.564012
+select * from subscription_retries where subscription_id = 133598;

# 2018-08-24 15:21:01.813207
+select count(1) from subscriptions where state = 0 and current_period_ends_at < now()::date;

# 2018-08-24 15:21:38.026349
+select id, current_period_ends_at from subscriptions where state = 0 and current_period_ends_at < now()::date order by current_period_ends_at desc limit 10;

# 2018-08-25 12:16:24.399996
+\q

# 2018-08-28 09:52:55.577866
+select count(1) from subscriptions where auto_renew = true;

# 2018-08-28 09:53:02.580195
+update subscriptions set auto_renew = false;

# 2018-08-28 10:17:17.417001
+select * from subscription_retries where subscription_id = 191060;

# 2018-08-28 10:51:53.654594
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-28 10:52:41.566551
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-28 10:53:32.759034
+select * from verification_address_verifications where verification_id = 186460;

# 2018-08-28 10:53:52.297482
+delete from verification_address_verifications where verification_id = 186460 and verified = false;

# 2018-08-28 10:53:56.729025
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-28 10:55:43.244810
+select * from subscription_retries where subscription_id = 191060;

# 2018-08-28 11:57:48.437277
+select count(1) from subscriptions where state = 2;

# 2018-08-28 11:58:07.548881
+select * from subscriptions where state = 2 order by current_period_ends_at desc limit 10;

# 2018-08-29 09:21:32.079615
+\q

# 2018-08-29 09:27:25.706184
+select now();

# 2018-08-29 09:27:46.870864
+select u.id, u.uuid, u.email, v.state as verification_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 5

# 2018-08-29 09:28:19.277956
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 5;

# 2018-08-29 09:35:54.446031
+\q

# 2018-08-29 10:13:19.449632
+select * from blog_posts where image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:13:31.237055
+select * from community_pledges where image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:13:42.535026
+select * from companies where logo_image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:14:00.279603
+select * from doggypedia_categories where image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:14:11.253021
+select * from doggypedia_pages where image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:14:25.236905
+select * from photos where image_id = '12e3280c89dd64341e193f6107411f34b4d5c8b792872f1b4ddf0a728267d03e';

# 2018-08-29 10:14:46.074809
+select * from profile_photo_albums where id = 1152861;

# 2018-08-29 10:14:55.060303
+select * from owners where id = 325079;

# 2018-08-29 10:15:09.019101
+select * from user_identities where id = 354903;

# 2018-08-29 10:15:18.235844
+select * from users where id = 371688;

# 2018-08-29 10:40:05.147879
+\q

# 2018-08-29 13:06:27.379089
+select count(1) form users where role <> 'user';

# 2018-08-29 13:06:36.785986
+select count(1) from users where role <> 'user';

# 2018-08-29 13:06:42.451924
+select count(1) from users where role != 'user';

# 2018-08-29 13:06:48.258081
+select count(1) from users where role <> 0;

# 2018-08-29 13:06:57.322842
+select * from users where role <> 0;

# 2018-08-29 13:08:02.397151
+\q

# 2018-08-29 13:10:13.122544
+select * from users where role <> 0;

# 2018-08-29 13:16:59.219595
+\q

# 2018-08-29 13:17:29.074384
+select * from users where role <> 0;

# 2018-08-29 13:18:50.323043
+\q

# 2018-08-30 08:54:53.954404
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-30 10:08:20.909514
+\q

# 2018-08-30 14:40:33.673095
+\d verification_artifacts;

# 2018-08-30 16:37:45.477441
+\q

# 2018-08-30 16:38:12.473286
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, rbr.type, rbr.provider_customer_id
+from subscriptions s
+inner join recurring_billing_resources rbr on s.id = rbr.subscription_id
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-30 16:42:29.160032
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-30 17:07:06.823130
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+and s.auto_renew = false
+order by s.current_period_ends_at desc;

# 2018-08-30 17:08:19.413804
+\q

# 2018-08-31 17:01:43.103530
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+and s.auto_renew = false
+order by s.current_period_ends_at desc;

# 2018-08-31 17:02:10.976942
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-08-31 17:02:52.077161
+\q

# 2018-09-03 10:24:48.927394
+select max(current_period_ends_at) from subscriptions where state = 0 and current_period_ends_at < now();

# 2018-09-03 10:24:55.083544
+\q

# 2018-09-03 10:58:22.414542
+select * from conversations order by random() limit 1;

# 2018-09-03 10:59:56.053638
+select * from conversation_participations where conversation_id = 947367;

# 2018-09-03 11:00:48.442283
+select * from conversation_messages where conversation_participation_id = 1859774;

# 2018-09-03 11:01:03.706775
+select * from conversation_messages where conversation_participation_id = 1859775;

# 2018-09-03 11:01:42.987489
+select * from conversation_participations where conversation_id = 947367;

# 2018-09-03 11:02:17.920871
+select * from conversation_participations where profile_id = 228779 and profile_type = 1;

# 2018-09-03 11:02:43.605060
+select * from users where id = 813286

# 2018-09-03 11:04:54.713743
+select cp.conversation_id, count(1) from conversation_participations cp group by cp.conversation_id order by count(1) desc limit 1;

# 2018-09-03 11:05:04.354463
+select cp.conversation_id, count(1) from conversation_participations cp group by cp.conversation_id order by count(1) desc limit 10;

# 2018-09-03 11:06:06.340627
+select cp.conversation_id, count(1) from conversation_participations cp inner join conversation_messages cm ON cm.conversation_participation_id = cp.id group by cp.conversation_id order by count(1) desc limit 1;

# 2018-09-03 11:06:31.644150
+select * from conversation_messages where conversation_participation_id = 74549;

# 2018-09-03 11:06:56.948959
+select * from conversation_participations where conversation_id = 74549;

# 2018-09-03 11:07:19.907611
+select * from conversation_messages where conversation_participation_id = 624014;

# 2018-09-03 11:14:40.303156
+select
+  cm.*
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm on cp1.id = cm.conversation_participation_id or cp2.id = cm.conversation_participation_id
+where c.id = 74549
+order by cm.created_at;

# 2018-09-03 11:16:25.838639
+select
+  cm.id,
+  cm.conversation_participation_id,
+  cm.created_at
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm on cp1.id = cm.conversation_participation_id or cp2.id = cm.conversation_participation_id
+where c.id = 74549
+order by cm.created_at;

# 2018-09-03 11:21:31.809006
+select
+  cm1.id,
+  cm1.conversation_participation_id,
+  cm1.created_at,
+  cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id ahd cm2.created_at < cm1.created_at)
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm1 on cp1.id = cm.conversation_participation_id
+where c.id = 74549
+order by cm.created_at

# 2018-09-03 11:21:45.290117
+select
+  cm1.id,
+  cm1.conversation_participation_id,
+  cm1.created_at,
+  cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at)
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm1 on cp1.id = cm.conversation_participation_id
+where c.id = 74549
+order by cm.created_at

# 2018-09-03 11:22:01.177850
+select
+  cm1.id,
+  cm1.conversation_participation_id,
+  cm1.created_at,
+  cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at)
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+where c.id = 74549
+order by cm1.created_at

# 2018-09-03 11:23:02.772256
+select
+  cm1.id,
+  cm1.conversation_participation_id,
+  cm1.created_at,
+  cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+from conversations c
+inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+where c.id = 74549
+order by cm1.created_at

# 2018-09-03 11:23:50.462770
+select average(responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 74549
+  order by cm1.created_at
+)

# 2018-09-03 11:24:05.734812
+select average(sq.responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 74549
+  order by cm1.created_at
+) sq

# 2018-09-03 11:24:18.135479
+select mean(sq.responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 74549
+  order by cm1.created_at
+) sq

# 2018-09-03 11:24:40.016486
+select avg(sq.responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 74549
+  order by cm1.created_at
+) sq

# 2018-09-03 11:25:18.561943
+select cp.conversation_id, count(1) from conversation_participations cp inner join conversation_messages cm ON cm.conversation_participation_id = cp.id group by cp.conversation_id order by count(1) desc limit 10;

# 2018-09-03 11:25:34.209749
+select avg(sq.responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 556111
+  order by cm1.created_at
+) sq

# 2018-09-03 11:25:41.857378
+select cp.conversation_id, count(1) from conversation_participations cp inner join conversation_messages cm ON cm.conversation_participation_id = cp.id group by cp.conversation_id order by count(1) desc limit 10;

# 2018-09-03 11:25:55.898957
+select avg(sq.responded_after) from (
+  select
+    cm1.id,
+    cm1.conversation_participation_id,
+    cm1.created_at,
+    cm1.created_at - (select max(cm2.created_at) from conversation_messages cm2 where cp2.id = cm2.conversation_participation_id and cm2.created_at < cm1.created_at) as responded_after
+  from conversations c
+  inner join conversation_participations cp1 on c.id = cp1.conversation_id and cp1.initiator = true
+  inner join conversation_participations cp2 on c.id = cp2.conversation_id and cp2.initiator = false
+  inner join conversation_messages cm1 on cp1.id = cm1.conversation_participation_id
+  where c.id = 413205
+  order by cm1.created_at
+) sq

# 2018-09-03 11:30:28.611933
+select count(1) from conversation_messages where group_message = true;

# 2018-09-03 11:30:34.852818
+select count(1) from conversation_messages where group_message = false;

# 2018-09-03 12:58:13.986402
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-09-03 12:59:26.491957
+\q

# 2018-09-03 14:36:26.229075
+select * from users order by email_invites_sent desc limit 1;

# 2018-09-03 15:28:27.125669
+select count(1) from verification_address_verifications where verified_at between '2018-07-01' and '2018-07-31' and id_verifier_status = 'passed';

# 2018-09-03 15:28:36.353661
+select count(1) from verification_address_verifications where verified_at between '2018-07-01' and '2018-07-31' and id_verifier_status = 1;

# 2018-09-03 15:31:18.563491
+select count(1) from verification_address_verifications where verified_at between '2018-07-01' and '2018-07-31' and id_verifier_status = 0;

# 2018-09-03 15:31:27.175978
+select count(1) from verification_address_verifications where verified_at between '2018-07-01' and '2018-07-31' and id_verifier_status <> 0;

# 2018-09-03 15:32:48.482019
+select count(1) from verification_address_verifications where verified_at between '2018-06-01' and '2018-06-30' and id_verifier_status <> 0;

# 2018-09-03 15:33:21.875386
+select count(1) from verification_address_verifications where verified_at between '2018-06-01' and '2018-06-30' and id_verifier_status = 1;

# 2018-09-03 15:33:31.138981
+select count(1) from verification_address_verifications where verified_at between '2018-06-01' and '2018-06-30' and id_verifier_status = 2;

# 2018-09-03 16:57:24.477761
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc

# 2018-09-03 16:57:55.667847
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 5

# 2018-09-03 16:58:39.572642
+select count(1)
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()

# 2018-09-03 16:59:14.375141
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 100

# 2018-09-03 17:01:07.505197
+select count(1)
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()

# 2018-09-05 11:15:37.311889
+select * from users where id = 1148573;

# 2018-09-05 11:15:48.198305
+update users set tracking_id = null where id = 1148573;

# 2018-09-05 11:15:50.246133
+select * from users where id = 1148573;

# 2018-09-06 09:54:43.874352
+select count(1)
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()

# 2018-09-06 09:54:54.971973
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 100;

# 2018-09-06 09:57:23.945740
+select count(1) from verification_artifacts where type = 'binary/octet-stream';

# 2018-09-06 09:57:28.483795
+select count(1) from verification_artifacts where file_type = 'binary/octet-stream';

# 2018-09-06 09:57:43.067238
+select file_name from verification_artifacts where file_type = 'binary/octet-stream' limit 10;

# 2018-09-06 09:59:26.273071
+select file_name, right(file_name, 5) from verification_artifacts where file_type = 'binary/octet-stream' limit 10;

# 2018-09-06 10:00:07.540271
+select count(1) from verification_artifacts where file_type = 'binary/octet-stream' and lower(right(file_name, 5)) = '.jpeg';

# 2018-09-06 10:00:13.220367
+select count(1) from verification_artifacts where file_type = 'binary/octet-stream';

# 2018-09-06 10:00:44.146111
+update verification_artifacts set file_type = 'image/jpeg' where lower(right(file_name, 5)) = '.jpeg';

# 2018-09-06 10:00:46.677504
+\q

# 2018-09-06 10:06:14.343091
+select count(1) from users where active = false and deleted_at is null;

# 2018-09-06 10:08:35.554560
+select count(1) from users where active = false and deleted_at is not null;

# 2018-09-06 10:09:00.062090
+select count(1) from users where active = false and deleted_at is null;

# 2018-09-06 10:09:32.444194
+select * from users where active = false and deleted_at is null;

# 2018-09-06 10:39:24.230850
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 100

# 2018-09-06 10:39:42.646059
+\q

# 2018-09-06 15:11:05.154000
+select * from users where phone in('441332989779',
+'447946523565',
+'447949148387',
+'447397576174',
+'447518318688',
+'447538922789',
+'441223571604',
+'447577763258',
+'447884416533',
+'447903421914',
+'442072740763',
+'447427677004',
+'447856338618',
+'447496572458',
+'447469248860',
+'447782249264',
+'447496572458'
+);

# 2018-09-06 15:11:33.311324
+select * from users where phone in ('01332989779',
+'07946523565',
+'07949148387',
+'07397576174',
+'07518318688',
+'07538922789',
+'01223571604',
+'07577763258',
+'07884416533',
+'07903421914',
+'02072740763',
+'07427677004',
+'07856338618',
+'07496572458',
+'07469248860',
+'07782249264',
+'07496572458'
+);

# 2018-09-06 15:14:21.677959
+select u.phone, u.uuid, s.created_at, 'blah' from users u left outer join subscriptions s on u.id = s.user_id where u.phone in ('01332989779',
+'07946523565',
+'07949148387',
+'07397576174',
+'07518318688',
+'07538922789',
+'01223571604',
+'07577763258',
+'07884416533',
+'07903421914',
+'02072740763',
+'07427677004',
+'07856338618',
+'07496572458',
+'07469248860',
+'07782249264',
+'07496572458');

# 2018-09-06 15:16:06.094417
+select u.phone, u.uuid, coalesce(s.created_at, ''), 'blah' from users u left outer join subscriptions s on u.id = s.user_id where u.phone in ('01332989779',
+'07946523565',
+'07949148387',
+'07397576174',
+'07518318688',
+'07538922789',
+'01223571604',
+'07577763258',
+'07884416533',
+'07903421914',
+'02072740763',
+'07427677004',
+'07856338618',
+'07496572458',
+'07469248860',
+'07782249264',
+'07496572458');

# 2018-09-06 15:32:35.343524
+select u.phone, u.uuid, s.created_at from users u left outer join subscriptions s on u.uid = s.user_id where u.phone in ('01380738245',
+'07709808902',
+'07522157755',
+'07803307706',
+'07557996070',
+'07974668721',
+'07554013714',
+'01293889614',
+'07763559401',
+'07754844609',
+'07968211874',
+'07495544858',
+'07980470816',
+'07973720447',
+'07916262870',
+'07808518134',
+'07795491018',
+'07958948549',
+'07879490487',
+'07809331200',
+'07845700983'
+);

# 2018-09-06 15:32:44.658364
+select u.phone, u.uuid, s.created_at from users u left outer join subscriptions s on u.id = s.user_id where u.phone in ('01380738245',
+'07709808902',
+'07522157755',
+'07803307706',
+'07557996070',
+'07974668721',
+'07554013714',
+'01293889614',
+'07763559401',
+'07754844609',
+'07968211874',
+'07495544858',
+'07980470816',
+'07973720447',
+'07916262870',
+'07808518134',
+'07795491018',
+'07958948549',
+'07879490487',
+'07809331200',
+'07845700983'
+);

# 2018-09-07 08:57:59.365803
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 100;

# 2018-09-07 08:58:09.276349
+select count(1)
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()

# 2018-09-07 08:58:26.703181
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-09-07 09:13:23.759907
+\q

# 2018-09-07 14:20:35.109682
+\?

# 2018-09-07 14:20:40.721631
+\dx

# 2018-09-07 14:21:13.722824
+drop extension 'fuzzystrmatch';

# 2018-09-07 14:21:28.728330
+drop extension fuzzystrmatch;

# 2018-09-07 14:21:31.688156
+\dx

# 2018-09-07 14:25:59.301346
+select id, tracking_id from users order by random() limit 10;

# 2018-09-07 16:17:04.040812
+\dt delayed_jobs

# 2018-09-07 16:17:07.048058
+\d delayed_jobs

# 2018-09-07 16:56:55.348236
+select * from delayed_jobs

# 2018-09-07 17:19:54.638606
+\q

# 2018-09-10 10:39:13.990775
+select * from delayed_jobs

# 2018-09-10 10:39:37.225431
+select last_error from delayed_jobs

# 2018-09-11 13:20:21.516117
+select u.id, u.uuid, u.email, v.state as verification_state, s.state as sub_state, s.current_period_ends_at
+from users u
+inner join subscriptions s on u.id = s.user_id
+left outer join verifications v on u.id = v.user_id
+where s.state = 0 and s.current_period_ends_at < now()
+order by s.current_period_ends_at desc
+limit 100

# 2018-09-11 13:20:38.102143
+select u.uuid, u.email, s.user_id, s.auto_renew, s.current_period_ends_at, v.state as verification_state, vav.verified as address_verified, vpv.verified as phone_verified, sr.retry_count
+from subscriptions s
+inner join users u on s.user_id = u.id
+inner join verifications v on u.id = v.user_id and v.state = 0
+left outer join verification_address_verifications vav on v.id = vav.verification_id
+left outer join verification_phone_verifications vpv on v.id = vpv.verification_id
+left outer join subscription_retries sr on s.id = sr.subscription_id
+where s.state = 2
+order by s.current_period_ends_at desc;

# 2018-09-11 13:20:55.820206
+\q

# 2018-09-14 11:40:06.269496
+select u.id, count(1) from users u inner join subscriptions s on u.id = s.user_id group by s.id having count(1) > 1 order by count(1) desc limit 10;

# 2018-09-14 11:40:14.951162
+select u.id, count(1) from users u inner join subscriptions s on u.id = s.user_id group by u.id having count(1) > 1 order by count(1) desc limit 10;

# 2018-09-14 11:40:57.618356
+select * from subscriptions where user_id = 141773;

# 2018-09-14 11:43:06.879970
+select u.id, count(1) from users u inner join subscriptions s on u.id = s.user_id and s.state = 0 group by u.id having count(1) > 1 order by count(1) desc limit 10;

# 2018-09-14 11:43:19.772289
+select * from subscriptions where user_id = 686024;

# 2018-09-14 11:44:31.807053
+u = User.find(686024)

# 2018-09-14 11:44:41.797091
+select * from users where id = 686024;

# 2018-09-14 11:47:15.997128
+select u.id, count(1) from users u inner join subscriptions s on u.id = s.user_id and s.state = 0 group by u.id having count(1) > 1 order by count(1) desc limit 10;

# 2018-09-14 11:47:24.096411
+select * from users where id = 704385;

# 2018-09-14 11:48:52.322575
+\q

# 2018-09-14 17:32:35.595969
+\q

# 2018-09-17 10:28:07.930944
+select id, email_invites_sent from users order by email_invites_sent desc limit 10;

# 2018-09-17 10:28:49.056371
+select count(1) from users where referral_id is not null;

# 2018-09-17 10:30:09.300023
+select id, referral_id from users where referral_id is not null limit 10;

# 2018-09-17 10:30:22.868498
+select id, referral_id from users where referral_id is not null order by id limit 10;

# 2018-09-17 10:30:39.178632
+select * from users where id = 115;

# 2018-09-17 10:34:44.079062
+select count(1) from user_referrals;

# 2018-09-17 10:35:12.278007
+select * from user_referrals limit 10

# 2018-09-17 10:35:26.153814
+select * from user_referrals order by created_at desc limit 10;'

# 2018-09-17 10:35:31.783474
+select * from user_referrals order by created_at desc limit 10;

# 2018-09-17 10:38:03.804520
+select * from users where referral_id = 512365;

# 2018-09-17 10:38:12.040233
+select * from user_referrals order by created_at desc limit 10;

# 2018-09-17 10:38:37.058836
+select * from users where id = 512365;

# 2018-09-17 10:39:08.708040
+select count(1) from user_referrals where referrer_id = 512365;

# 2018-09-17 11:13:12.480997
+select count(1) from user_Registration_channels;

# 2018-09-17 11:13:22.330674
+select * from user_registration_channels limit 1;

# 2018-09-17 11:13:26.672791
+select * from user_registration_channels limit 10;'

# 2018-09-17 11:13:37.864503
+select * from user_registration_channels order by id desc limit 10;

# 2018-09-17 11:15:56.582633
+\d users

# 2018-09-17 11:20:12.180672
+select longitude, latitude, location from users where id = 1148561;

# 2018-09-17 11:23:54.216546
+select id, uuid, firstname, surname, ST_Distance(ST_GeographyFromText('SRID=4326;POINT(' || longitude || ' ' || latitude || ')'), location) / 1609.34 as distance from users order by distance limit 10;

# 2018-09-17 11:24:04.074777
+select longitude, latitude, location from users where id = 1148561;

# 2018-09-17 11:25:07.204744
+select id, uuid, firstname, surname, ST_Distance(ST_GeographyFromText('SRID=4326;POINT(-0.1868611 51.9792542)'), location) / 1609.34 as distance from users order by distance limit 10;

# 2018-09-17 11:26:38.234150
+select id, uuid, firstname, surname, ST_Distance('0101000020E6100000F47FB28410EBC7BF3EBC9D3358FD4940', location) / 1609.34 as distance from users order by distance limit 10;

# 2018-09-17 11:26:56.096598
+select id, uuid, firstname, surname, ST_Distance(geography'0101000020E6100000F47FB28410EBC7BF3EBC9D3358FD4940', location) / 1609.34 as distance from users order by distance limit 10;

# 2018-09-17 11:30:04.222291
+select country_id, count(1) from users group by country_id;

# 2018-09-19 18:43:07.401699
+\d users

# 2018-09-19 18:44:49.249667
+alter table users alter column tracking_id drop not null;

# 2018-09-20 08:58:29.929878
+alter table users alter column tracking_id add not null;

# 2018-09-20 08:58:38.718179
+alter table users alter column tracking_id not null;

# 2018-09-20 08:58:53.991118
+alter table users alter column tracking_id set not null;

# 2018-09-20 08:59:10.905403
+update users set tracking_id = gen_uuid() where tracking_id is null;

# 2018-09-20 09:00:05.794255
+update users set tracking_id = gen_random_uuid() where tracking_id is null;

# 2018-09-20 09:00:10.275410
+alter table users alter column tracking_id set not null;

# 2018-09-20 11:21:50.311989
+alter table users alter column tracking_id drop not null;

# 2018-09-20 14:34:54.363033
+\d conversation_messages

# 2018-09-20 14:35:13.576188
+\d conversation_participations

# 2018-09-20 14:35:49.820159
+\d conversation_unread_messages

# 2018-09-20 14:39:05.121876
+select u.id, count(1)
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id
+  where s.id is null
+  group by u.id
+  order by count(1) desc
+  limit 10

# 2018-09-20 14:39:27.536379
+\d conversation_messages

# 2018-09-20 14:40:13.148254
+\d conversation_participations

# 2018-09-20 14:41:06.227759
+\d conversation_messages

# 2018-09-20 14:41:40.622496
+\d conversation_unread_messages

# 2018-09-20 14:42:56.995229
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  left outer join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  order by count(1) desc
+  limit 10;

# 2018-09-20 14:43:37.519520
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  order by count(1) desc
+  limit 10;

# 2018-09-20 14:43:55.933420
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 14:44:32.152667
+select * from conversation_participations where user_id = 151509 and initiator = false

# 2018-09-20 14:46:16.617316
+select * from conversation_participations cp inner join conversation_messages cm on cp.id = cm.conversation_participation_id and cp.initiator = false where cp.user_id = 151509;

# 2018-09-20 14:47:11.692714
+select cp.id, count(1) from conversation_participations cp left outer join conversation_messages cm on cp.id = cm.conversation_participation_id and cp.initiator = false where cp.user_id = 151509 group by cp.id, cp.user_id;

# 2018-09-20 14:47:34.964036
+select cp.id, count(cm.id) from conversation_participations cp left outer join conversation_messages cm on cp.id = cm.conversation_participation_id and cp.initiator = false where cp.user_id = 151509 group by cp.id, cp.user_id;

# 2018-09-20 14:47:49.263857
+select * from conversation_messages where conversation_participation_id = 614016;

# 2018-09-20 14:48:05.225408
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  order by count(distinct cm.id) desc
+  limit 100

# 2018-09-20 14:48:48.308011
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 14:49:16.036246
+\d conversation_unread_messages

# 2018-09-20 14:49:41.782082
+select count(1) from conversation_unr

# 2018-09-20 14:49:45.144120
+select count(1) from conversation_unread_messages;

# 2018-09-20 14:49:57.165580
+select * from conversation_unread_messages order by random() limit 1;

# 2018-09-20 14:50:22.983718
+select * from conversation_participations cp where cp.id = 352023;

# 2018-09-20 14:50:56.138314
+select * from conversation_messages where id = 234522;

# 2018-09-20 14:53:10.515069
+select u.id, cm.*, cum.*
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309;

# 2018-09-20 14:53:23.169689
+select u.id, cm.*, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 14:53:34.370290
+select u.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 14:54:18.921948
+select * from conversation_unread_messages where id = 23126;

# 2018-09-20 14:54:37.740741
+select u.id, cp.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 14:55:06.367373
+select u.id, cp.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false
+  left outer join conversation_messages cm on cp.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 14:55:33.679650
+select * from conversation_participations cp where cp.id = 352023;

# 2018-09-20 14:57:27.993143
+select * from users u left outer join subscriptions s on u.id = s.user_id inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false

# 2018-09-20 14:57:44.838469
+select * from users u left outer join subscriptions s on u.id = s.user_id inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false where u.id = 87309;

# 2018-09-20 14:57:55.391016
+select cp.id from users u left outer join subscriptions s on u.id = s.user_id inner join conversation_participations cp on u.id = cp.user_id and cp.initiator = false where u.id = 87309;

# 2018-09-20 14:58:27.875942
+select * from conversation_messages where conversation_participation_id = 352023;

# 2018-09-20 15:00:08.865933
+select * from conversation_messages where id = 234522;

# 2018-09-20 15:01:56.672388
+select * from conversation_participations cp where cp.id = 53517;

# 2018-09-20 15:04:20.217331
+select * from conversation_messages where id = 234522;

# 2018-09-20 15:05:41.025939
+select * from conversation_messages where conversation_participation_id = 352023;

# 2018-09-20 15:11:34.577007
+\d conversation_messages

# 2018-09-20 15:13:47.300243
+select u.id, cp.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp2.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:13:58.506547
+select u.id, cp1.id, cp2.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp2.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:14:48.869987
+select u.id, cp1.id, cp2.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:15:34.969444
+l

# 2018-09-20 15:15:36.809952
+```sql
+select u.id, cp1.conversation_id, cp1.id, cp2.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:15:44.821519
+select u.id, cp1.conversation_id, cp1.id, cp2.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:17:07.193012
+select u.id, count(distinct cp1.conversation_id) as conversation_count, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309
+  group by u.id

# 2018-09-20 15:17:17.001117
+select u.id, cp1.conversation_id, cp1.id, cp2.id, cm.id, cum.id
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309

# 2018-09-20 15:17:43.974713
+select u.id, count(distinct cp1.conversation_id) as conversation_count, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  left outer join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309
+  group by u.id

# 2018-09-20 15:18:36.405067
+select u.id, count(distinct cp1.conversation_id) as conversation_count, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309
+  group by u.id

# 2018-09-20 15:19:01.612185
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 15:19:12.247242
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 15:32:12.599664
+select cm.* from conversation_messages cm inner join conversation_participations cp on cm.conversation_participation_id = cp.id where cp.user_id = 133827 order by cm.created_at desc limit 5;

# 2018-09-20 15:33:40.112303
+select cm.* from conversation_messages cm inner join conversation_participations cp1 on cm.conversation_participation_id = cp1.id and cp1.initiator = false inner join conversation_participations cp2 on cp2.conversation_id = cp.conversation_id and cp2.initiator = true where cp1.user_id = 133827 order by cm.created_at desc limit 5;

# 2018-09-20 15:33:47.232146
+select cm.* from conversation_messages cm inner join conversation_participations cp1 on cm.conversation_participation_id = cp1.id and cp1.initiator = false inner join conversation_participations cp2 on cp2.conversation_id = cp1.conversation_id and cp2.initiator = true where cp1.user_id = 133827 order by cm.created_at desc limit 5;

# 2018-09-20 15:34:37.144607
+select cm.* from conversation_messages cm inner join conversation_participations cp2 on cm.conversation_participation_id = cp2.id and cp2.initiator = true inner join conversation_participations cp1 on cp1.conversation_id = cp2.conversation_id and cp1.initiator = false where cp1.user_id = 133827 order by cm.created_at desc limit 5;

# 2018-09-20 15:38:05.896317
+\d conversation_messages

# 2018-09-20 15:38:10.779155
+\d conversation_participations

# 2018-09-20 15:38:49.054342
+\d user_identities

# 2018-09-20 15:39:01.630086
+\d borrowers

# 2018-09-20 15:39:56.081502
+\d conversation_participations

# 2018-09-20 15:41:20.166651
+select u.id, count(distinct cp1.conversation_id) as conversation_count, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where u.id = 87309
+  group by u.id

# 2018-09-20 15:43:37.231996
+select count(1) from profile_photo_albums;

# 2018-09-20 15:43:48.602276
+select count(1) from user_identites;

# 2018-09-20 15:43:55.401790
+select count(1) from user_identities;

# 2018-09-20 15:44:14.153021
+select count(1) from profile_photo_albums where primary_photo_id is null

# 2018-09-20 15:44:19.092583
+select count(1) from profile_photo_albums where primary_photo_id is not null

# 2018-09-20 15:44:42.345610
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 15:45:17.306930
+select * from profile_photo_albums limit 10;

# 2018-09-20 15:45:29.292709
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 15:47:11.330840
+select u.id, count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is not null
+  group by u.id
+  having count(distinct cum.id) > 0
+  order by count(distinct cm.id) desc
+  limit 10

# 2018-09-20 15:48:15.342235
+select count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is not null

# 2018-09-20 15:49:51.586614
+select count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is null

# 2018-09-20 15:54:47.414962
+select count(distinct cm.id) as received_message_count, count(distinct cum.id) as received_unread_message_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  left outer join conversation_unread_messages cum on u.id = cum.user_id and cp1.id = cum.conversation_participation_id and cm.id = cum.conversation_message_id
+  where s.id is null and ppa.primary_photo_id is not null

# 2018-09-20 15:57:00.745119
+\q

# 2018-09-20 16:54:11.796465
+select c.id, count(1)
+from conversations c
+inner join conversation_participations cp on c.id = cp.conversation_id
+inner join conversation_messages cm on cp.id = cm.conversation_participation_id
+group by c.id
+order by count(1) desc
+limit 10

# 2018-09-20 16:57:07.886040
+select count(distinct cm.id) as messages_in_conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversation_messages cm on cp2.id = cm.conversation_participation_id
+  where s.id is null and ppa.primary_photo_id is not null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id or cm2.conversation_participation_id = cp2.id) > 1

# 2018-09-20 17:00:15.035358
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is not null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id or cm2.conversation_participation_id = cp2.id) > 1

# 2018-09-20 17:01:35.163904
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is not null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id or cm2.conversation_participation_id = cp2.id) = 1

# 2018-09-20 17:03:21.465754
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is not null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id) > 0

# 2018-09-20 17:03:55.307537
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is not null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id) = 0

# 2018-09-20 17:04:52.536292
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id) > 0

# 2018-09-20 17:05:23.086828
+select count(distinct c.id) as conversation_count
+  from users u
+  left outer join subscriptions s on u.id = s.user_id
+  inner join user_identities ui on u.id = ui.user_id
+  left outer join borrowers b on ui.id = b.user_identity_id
+  left outer join owners o on ui.id = o.user_identity_id
+  inner join profile_photo_albums ppa on (ppa.profile_type = 'Borrower' and ppa.profile_id = b.id) or (ppa.profile_type = 'Owner' and ppa.profile_id = o.id)
+  inner join conversation_participations cp1 on u.id = cp1.user_id and cp1.initiator = false and ((cp1.profile_type = 0 and cp1.profile_id = b.id) or (cp1.profile_type = 1 and cp1.profile_id = o.id))
+  inner join conversation_participations cp2 on cp1.conversation_id = cp2.conversation_id and cp2.initiator = true
+  inner join conversations c on cp2.conversation_id = c.id and cp1.conversation_id = c.id
+  where s.id is null and ppa.primary_photo_id is null and (select count(1) from conversation_messages cm2 where cm2.conversation_participation_id = cp1.id) = 0

# 2018-09-21 10:07:36.353271
+select max(id) from community_pledges;

# 2018-09-21 10:07:53.126852
+select * from community_pledges where id = 35;

# 2018-09-21 17:16:50.201790
+\q

# 2018-09-24 10:31:20.191037
+\d experiment_logs

# 2018-09-24 10:31:34.454861
+select * from experiment_logs order by id desc limit 1;

# 2018-09-24 10:32:01.913878
+select count(1) from experiment_logs el where el.experiment = 'remove-widgets-from-signup-50-50';

# 2018-09-24 10:33:08.214955
+select * from experiment_logs order by id desc limit 1;

# 2018-09-24 10:33:25.982000
+\d experiments

# 2018-09-24 10:34:42.680522
+select * from experiment_logs order by id desc limit 1;

# 2018-09-24 10:36:12.497573
+select el.variant, count(1)
+from experiment_logs el
+inner join users u on el.user_id = u.id
+inner join user_identities ui on u.id = ui.user_id
+inner join borrowers b on ui.id = b.user_identity_id
+where el.experiment = 'remove-widgets-from-signup-50-50'
+and b.completed_at is not null
+group by el.variant

# 2018-09-24 10:38:03.278889
+select el.variant, count(1)
+from experiment_logs el
+inner join users u on el.user_id = u.id
+inner join user_identities ui on u.id = ui.user_id
+inner join owners o on ui.id = o.user_identity_id
+where el.experiment = 'remove-widgets-from-signup-50-50'
+and o.completed_at is not null
+group by el.variant

# 2018-09-24 10:39:36.717811
+select el.variant, count(1)
+from experiment_logs el
+inner join users u on el.user_id = u.id
+inner join subscriptions s on u.id = s.user_id
+inner join subscription_plans sp on s.subscription_plan_id = sp.id
+where el.experiment = 'remove-widgets-from-signup-50-50'
+and sp.profile_type = 0
+group by el.variant

# 2018-09-24 10:40:27.344694
+select el.variant, count(1)
+from experiment_logs el
+inner join users u on el.user_id = u.id
+inner join subscriptions s on u.id = s.user_id
+inner join subscription_plans sp on s.subscription_plan_id = sp.id
+where el.experiment = 'remove-widgets-from-signup-50-50'
+and sp.profile_type = 1
+group by el.variant

# 2018-09-24 10:42:15.305405
+\q
